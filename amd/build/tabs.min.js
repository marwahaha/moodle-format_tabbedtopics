define(["jquery","jqueryui"],function(a){return{init:function(){var b=function(b,c){console.log("single section in tab - performing some magic..."),c.find(".toggle_closed").click(),c.find(".sectionhead").addClass("temp-headline"),a(".temp-headline").removeClass("sectionhead"),a(".temp-headline").removeClass("toggle-switch"),c.find(".the_toggle").addClass("the_toggle_disabled"),a(".the_toggle_disabled").removeClass("the_toggle");var d=c.find(".sectionname");if("off"===a("input[name='edit']").val()){var e=b.find("span[data-itemtype='tabname']");e.addClass("d-inline-flex-disabled"),e.removeClass("d-inline-flex"),e.hide(),b.append(d.html()),d.addClass("hidden_sectionname"),d.removeClass("sectionname"),d.hide()}else b.html(d.html()),d.hide()},c=function(b){var c=b.find(".hidden_sectionname");c.addClass("sectionname"),c.removeClass("hidden_sectionname"),c.show(),a(".temp-headline").addClass("sectionhead"),a(".temp-headline").addClass("toggle-switch"),a(".temp-headline").removeClass("temp-headline"),a(".the_toggle_disabled").addClass("the_toggle"),a(".the_toggle_disabled").removeClass("the_toggle_disabled"),console.log("--> restoring section headline ")},d=function(a){var b=a.find("span[data-itemtype='tabname']");a.find("span[data-itemtype='sectionname']").first().remove(),b.removeClass("d-inline-flex-disabled"),b.addClass("d-inline-flex"),b.show()},e=function(){a(".tablink").on("click",function(){var e=a(this).attr("id"),f=a(this).attr("sections"),g=f.split(",");console.log("----");var h;a(this).find(".inplaceeditable-text")&&(h=a(this).find(".inplaceeditable-text").attr("data-value")),"undefined"==typeof h&&(h=a(this).html()),console.log('Clicked tab "'+h+'":'),a(".assessment_info_content").hide(),a(".active").removeClass("active"),a(".modulecontent").addClass("active"),"tab0"===e?(a("#changenumsections").show(),a("li.section").show(),a(".topictab").each(function(){a(this).attr("sections").length>0&&a.each(a(this).attr("sections").split(","),function(b,c){var d=a(".section[section-id='"+c+"']");d.hide(),console.log("hiding section "+c)})})):(a("#changenumsections").show(),a("li.section").hide(),a.each(g,function(b,c){var d=a(".section[section-id='"+c+"']");d.show(),console.log("showing section "+c)})),a(".section0_ontop".length>0)&&a("#section-0").removeClass("sectionxxx"),a("#ontop_area #section-0").show();var i=a("li.section:visible").length,j=a("li.section.hidden:visible").length;if(a(".section0_ontop").length>0&&i--,console.log("number of visible sections: "+i),console.log("number of hidden sections: "+j),i<=j){if(a(this).addClass("tab-not-shown"),0===a("#not-shown-hint-"+e).length){var k="This tab contains only hidden sections and will not be shown to students";a(this).append('<i id="not-shown-hint-'+e+'" class="fa fa-info" title="'+k+'"></i>')}}else a(this).removeClass("tab-not-shown"),a("#not-shown-hint-"+e).remove();if(i<1?(console.log("tab with no visible sections or blocks - hiding it"),a(this).parent().hide()):(console.log("tab with visible sections or blocks - showing it"),a(this).parent().show()),a(".tabtopics").length>0&&console.log("--> # of tabtopics: "+a(".tabtopics").length),a(".single_section_tab").length>0){var l=a("li.section:visible").first(),m=a("li.section:visible").first().attr("id");1!==i||"section-0"==m||a("li.section:visible").first().hasClass("hidden")||a("li.section:visible").first().hasClass("stealth")?"off"===a("input[name='edit']").val()&&"section-0"!=m&&(d(a(this)),c(l)):b(a(this),l)}})},f=function(){a(".ontop_mover").on("click",function(){a("#ontop_area").append(a(this).closest(".section"))})},g=function(){a(".inline_mover").on("click",function(){var b=a(this).closest(".section").attr("section-id");a("#inline_area").append(a(this).closest(".section")),a(".tablink").each(function(){if(a(this).attr("sections").indexOf(b)>-1)return a(this).click(),!1})})},h=function(){a(".tab_mover").on("click",function(){var b=a(this).attr("tabnr"),e=a(this).closest("li.section").attr("section-id"),f=a(this).parent().parent().parent().parent().parent().parent().parent().attr("id").substring(8);console.log("--> found section num: "+f);var g=a(".topictab.active").first().attr("id"),h=a(".section[section-id='"+e+"']");"undefined"==typeof g&&(g="tab0"),console.log("----"),console.log("moving section "+e+' from tab "'+g+'" to tab nr '+b),a(".tablink").each(function(){a(this).attr("sections",a(this).attr("sections").replace(","+e,"")),a(this).attr("sections",a(this).attr("sections").replace(e+",","")),a(this).attr("sections",a(this).attr("sections").replace(e,"")),a(this).attr("section_nums",a(this).attr("section_nums").replace(","+f,"")),a(this).attr("section_nums",a(this).attr("section_nums").replace(f+",","")),a(this).attr("section_nums",a(this).attr("section_nums").replace(f,""))}),b>0&&(0===a("#tab"+b).attr("sections").length?a("#tab"+b).attr("sections",a("#tab"+b).attr("sections")+e):a("#tab"+b).attr("sections",a("#tab"+b).attr("sections")+","+e),0===a("#tab"+b).attr("section_nums").length?a("#tab"+b).attr("section_nums",a("#tab"+b).attr("section_nums")+f):(a("#tab"+b).attr("section_nums",a("#tab"+b).attr("section_nums")+","+f),console.log("---> section_nums: "+a("#tab"+b).attr("section_nums"))),a("#tab"+b).click(),a("#"+g).click()),d(a("#tab"+b)),c(h);var i=a(".topictab:visible").length;console.log("visible tabs: "+i),a(".topictab:visible").length>0&&(a("li.section:visible").length>1?(console.log("staying with the current tab (id = "+g+") as there are still "+a("li.section:visible").length+" sections left"),a("#tab"+b).click(),a("#"+g).click()):(console.log("no section in active tab id "+g+" left - hiding it and following section to new tab nr "+b),a("#tab"+b).click(),a("#"+g).parent().hide()))})},i=function(b,c){var d=c.draggable.find(".topictab").first(),i=a(this).find(".topictab").first(),j=c.draggable.find(".topictab").first().attr("id"),k=a(this).find(".topictab").first().attr("id");console.log('The tab with ID "'+j+'" was dropped onto tab with the ID "'+k+'"');var l=d.parent().html();d.parent().html(i.parent().html()),i.parent().html(l),e(),h(),f(),g();var m="";a(".tablink").each(function(){var b=a(this).attr("id");void 0!==b&&(m=""===m?a(this).attr("id"):m.concat(",").concat(a(this).attr("id")))});var n=a(".topictab:visible").first().attr("sections").split(",")[0];"block_assessment_information"===n&&(n=a(".topictab:visible:eq(1)").attr("sections").split(",")[0]),a.ajax({url:"format/tabtopics/ajax/update_tab_seq.php",type:"POST",data:{sectionid:n,tab_seq:m},success:function(a){console.log("the new tab sequence: "+a)}})};a(".list-group-item").click(function(){var b=a(this).find(".media-body").html(),c=a('.section[aria-label="'+b+'"]').attr("section-id"),d=!1;a(".tablink").each(function(){if(a(this).attr("sections").indexOf(c)>-1)return a(this).click(),d=!0,!1}),d||a("#tab0").click()}),a(document).ready(function(){e(),h(),f(),g(),0===a(".section0_ontop").length&&a("#section-0 .right.side").show(),a(".tablink .fa-pencil").length>0&&(a(".topictab").parent().draggable({cursor:"move",stack:".tabitem",revert:!0}),a(".topictab").parent().droppable({accept:".tabitem",hoverClass:"hovered",drop:i})),a(".topictab:visible").length>0&&(a("#tab0").click(),a(".tablink:visible").click(),a(".tablink:visible").first().click())})}}});